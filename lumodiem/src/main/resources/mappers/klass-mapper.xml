<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="klassMapper">

	<resultMap type="klassVo" id="klassMap">
		<!-- 
			컬럼명과 필드명을 1대1로 써준다.
		 	vo의 필드명과 테이블의 컬럼명이 다르기 때문에 맞춰즌 것!
		 -->
		<result property="klassNo" column="klass_no"/>
		<result property="accountNo" column="account_no"/>
		<result property="klassName" column="klass_name"/>
		<result property="klassAddress" column="klass_address"/>
		<result property="klassPrice" column="klass_price"/>
		<result property="klassMax" column="klass_max"/>
		<result property="klassStatus" column="klass_status"/>
		<result property="klassTxt" column="klass_txt"/>
		<result property="accountNickname" column="account_nickname"/>
		<result property="klassRegDate" column="klass_reg_date"/>
		<result property="klassModDate" column="klass_mod_date"/>
	</resultMap>
		
	<insert id="klassCreate" parameterType="klassVo" useGeneratedKeys="true" keyProperty="klassNo">
		INSERT INTO `klass`(account_no ,klass_name ,klass_address ,klass_max ,klass_price ,klass_txt ,klass_reg_date ,klass_mod_date)
		VALUES(#{accountNo} ,#{klassName} ,#{klassAddress} ,#{klassMax} ,#{klassPrice} ,#{klassTxt} ,#{klassRegDate} ,#{klassModDate})
	</insert>
	
	<select id="klassList" resultMap="klassMap" parameterType="klassVo">
		SELECT k.* ,a.account_nickname
		FROM `klass` k
		JOIN `account` a
		ON k.account_no = a.account_no
		<where>
			<if test='searchType != null and searchType.equals("0") == false and searchType.equals("1")'>
				AND k.klass_name LIKE CONCAT('%' ,#{searchTxt} ,'%')
			</if>
			<if test='searchType != null and searchType.equals("0") == false and searchType.equals("2")'>
				AND a.account_nickname LIKE CONCAT('%' ,#{searchTxt} ,'%')
			</if>
			<if test='searchType != null and searchType.equals("0") == false and searchType.equals("3")'>
				AND k.klass_txt LIKE CONCAT('%' ,#{searchTxt} ,'%')
			</if>
		</where>
		<if test='orderType != null and orderType.equals("x") == false'>
			<choose>
				<when test='orderType.equals("a") == true'>
					ORDER BY k.klass_reg_date DESC
				</when>
				<otherwise>
					ORDER BY k.klass_reg_date ASC
				</otherwise>
			</choose>
		</if>
	</select>
	
</mapper>